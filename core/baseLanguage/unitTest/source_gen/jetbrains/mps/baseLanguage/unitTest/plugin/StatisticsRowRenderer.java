package jetbrains.mps.baseLanguage.unitTest.plugin;

/*Generated by MPS */

import javax.swing.table.TableCellRenderer;
import javax.swing.JPanel;
import javax.swing.JLabel;
import java.awt.BorderLayout;
import java.awt.Color;
import javax.swing.SwingConstants;
import java.awt.Font;
import java.awt.GridLayout;
import java.awt.Component;
import javax.swing.JTable;
import javax.swing.JComponent;
import javax.swing.UIManager;
import javax.swing.BorderFactory;

public class StatisticsRowRenderer implements TableCellRenderer {
  private static final String INDENT = "    ";

  private final JPanel myTextPanel;
  private final JLabel myText;
  private final JLabel myAdvancedText;
  private final JLabel mySimpleField;
  private final JPanel myStatePanel;
  private final JLabel mySuccess;
  private final JLabel myError;
  private final JLabel myFailure;
  private final JLabel myAloneSuccess;
  private final JLabel myAloneError;
  private final JLabel myAloneFailure;

  public StatisticsRowRenderer() {

    this.myTextPanel = new JPanel(new BorderLayout());
    this.myText = new JLabel();
    this.myTextPanel.add(this.myText, BorderLayout.WEST);
    this.myAdvancedText = new JLabel();
    this.myAdvancedText.setForeground(Color.GRAY);
    this.myTextPanel.add(this.myAdvancedText, BorderLayout.CENTER);
    this.mySimpleField = new JLabel("", SwingConstants.RIGHT);

    // container states 

    this.mySuccess = new JLabel("", SwingConstants.RIGHT);
    Font font = this.mySuccess.getFont();
    Font boldFont = new Font(font.getName(), Font.BOLD, font.getSize());
    this.mySuccess.setForeground(new Color(0, 127, 0));
    this.mySuccess.setFont(boldFont);

    this.myFailure = new JLabel("", SwingConstants.RIGHT);
    this.myFailure.setForeground(Color.RED);
    this.myFailure.setFont(boldFont);

    this.myError = new JLabel("", SwingConstants.RIGHT);
    this.myError.setForeground(Color.RED);
    this.myError.setFont(boldFont);

    this.myStatePanel = new JPanel(new GridLayout(1, 3));
    this.myStatePanel.add(this.mySuccess, BorderLayout.WEST);
    this.myStatePanel.add(this.myFailure, BorderLayout.CENTER);
    this.myStatePanel.add(this.myError, BorderLayout.EAST);

    // single test states 

    this.myAloneSuccess = new JLabel("Passed", SwingConstants.RIGHT);
    this.myAloneSuccess.setForeground(new Color(0, 127, 0));
    this.myAloneSuccess.setFont(boldFont);

    this.myAloneFailure = new JLabel("Failed", SwingConstants.RIGHT);
    this.myAloneFailure.setForeground(Color.RED);
    this.myAloneFailure.setFont(boldFont);

    this.myAloneError = new JLabel("Error", SwingConstants.RIGHT);
    this.myAloneError.setForeground(Color.RED);
    this.myAloneError.setFont(boldFont);
  }

  public Component getTableCellRendererComponent(JTable table, Object value, boolean isSelected, boolean hasFocus, int row, int column) {
    TestStatisticsRow rowValue = (TestStatisticsRow) value;
    JComponent result = null;
    boolean keepForeground = false;
    JComponent adjustFont = null;
    boolean container = rowValue instanceof TestContainerRow;
    switch (column) {
      case 0:
        // Test 
        String text = rowValue.getText();
        if (!(container)) {
          text = INDENT + text;
        }
        this.myText.setText(text);
        String additionalText = rowValue.getAdditionalText();
        if (additionalText != null) {
          this.myAdvancedText.setText(" (" + additionalText + ")");
        } else {
          this.myAdvancedText.setText("");
        }
        result = this.myTextPanel;
        adjustFont = this.myText;
        break;
      case 1:
        // Time elapsed 
        result = this.setTime(rowValue.getElapsedTime());
        adjustFont = result;
        break;
      case 2:
        // Usage Delta 
        result = this.setMemoryUsage(rowValue.getUsageDelta());
        adjustFont = result;
        break;
      case 3:
        // Usage Before 
        result = this.setMemoryUsage(rowValue.getUsageBefore());
        adjustFont = result;
        break;
      case 4:
        // Usage After 
        result = this.setMemoryUsage(rowValue.getUsageAfter());
        adjustFont = result;
        break;
      case 5:
        // Results 
        int s = rowValue.getSuccessful();
        int f = rowValue.getFailed();
        int e = rowValue.getErrored();
        if (container) {
          this.mySuccess.setText((s > 0 ?
            ("P:" + s) :
            ""
          ));
          this.myFailure.setText((f > 0 ?
            ("F:" + f) :
            ""
          ));
          this.myError.setText((e > 0 ?
            ("E:" + e) :
            ""
          ));
          result = this.myStatePanel;
        } else if ((s + f + e) >= 1) {
          if (s > 0) {
            result = this.myAloneSuccess;
          }
          if (f > 0) {
            result = this.myAloneFailure;
          }
          if (e > 0) {
            result = this.myAloneError;
          }
        } else {
          this.mySimpleField.setText("");
          result = this.mySimpleField;
        }
        keepForeground = true;
        break;
      default:
    }
    result.setOpaque(true);
    if (isSelected) {
      if (!(keepForeground)) {
        result.setForeground(table.getSelectionForeground());
      }
      result.setBackground(table.getSelectionBackground());
    } else {
      if (!(keepForeground)) {
        result.setForeground(table.getForeground());
      }
      result.setBackground(table.getBackground());
    }
    if (hasFocus) {
      result.setBorder(UIManager.getBorder("Table.focusCellHighlightBorder"));
    } else {
      result.setBorder(BorderFactory.createEmptyBorder(1, 1, 1, 1));
    }
    result.setEnabled(table.isEnabled());
    if (adjustFont != null) {
      if (container) {
        Font font = table.getFont();
        adjustFont.setFont(new Font(font.getName(), Font.BOLD, font.getSize()));
      } else {
        adjustFont.setFont(table.getFont());
      }
    }
    return result;
  }

  private JLabel setTime(long time) {
    String text = "";
    if (time >= 0) {
      text = String.format("%.3f s", time / 1000.0);
    }
    this.mySimpleField.setText(text);
    return this.mySimpleField;
  }

  private JLabel setMemoryUsage(long usage) {
    String s = String.format("%d Kb", usage / 1024);
    this.mySimpleField.setText(s);
    return this.mySimpleField;
  }
}
